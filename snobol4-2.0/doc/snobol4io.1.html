<!-- generated by $Id: snopea.sno,v 1.33 2015/01/02 03:31:20 phil Exp $ -->
<html>
<head>
<title>SNOBOL4IO(1) | CSNOBOL4B 2.0 | January 1, 2015</title>
</head>
<body>
<h1>SNOBOL4IO(1) | CSNOBOL4B 2.0 | January 1, 2015</h1>
<h2>NAME</h2>
snobol4io &ndash; SNOBOL4 file I/O
<h2>DESCRIPTION</h2>
Macro SNOBOL4 originally depended on <B>FORTRAN</B> libraries, unit
numbers and <B>FORMAT</B>s for input and output.  CSNOBOL4 uses the C
<B>stdio</B>(3) library instead, but unit numbers (INTEGERs between 1 and
256) and record lengths remain embedded in the Macro SNOBOL4 code.
<h3>I/O Associations</h3>
Output on a closed unit generates a fatal &ldquo;Output error&rdquo;,
see <a href="snobol4error.1.html"><B>snobol4error</B>(1)</a>.
<p>
The following variable/unit/file associations exist by default;
<p>
<table>
<tr><td>Variable<td>Unit<td>Association
<tr><td><B>INPUT</B><td>5<td>standard input (input)
<tr><td><B>OUTPUT</B><td>6<td>standard output (output)
<tr><td><B>TERMINAL</B><td>7<td>standard error (output)
<tr><td><B>TERMINAL</B><td>8<td>/dev/tty (input)
</table>
<h3>Named files</h3>
Input and output filenames can be supplied to the <B>INPUT()</B> and
<B>OUTPUT()</B> functions via an optional fourth argument.
<dl>
<p>
<dt>
filename - (hyphen)
<dd>
is interpreted as stdin on <B>INPUT()</B> and stdout on <B>OUTPUT()</B>.
<p>
<dt>
sub-process I/O using PIPE and Pseudo-terminals
<dd>
If the filename begins with single a vertical bar (<B>|</B>),
the remainder is used
as a shell command whose stdin (in the case of <B>OUTPUT()</B>) or stdout
(in the case of <B>INPUT()</B>) will be connected to the file variable via
a pipe.  If a pipe is opened by INPUT() input in &ldquo;update&rdquo; mode, the
connection will be bi-directional (on systems with socketpair and
Unix-domain sockets).  See below for how to associate a variable for
I/O in both directions.
<p>
<dt>

<dd>
If the filename begins with two vertical bars (<B>||</B>) the remainder is
used as a shell command executed with stdin, stdout and stderr
attached to the slave side of a pseudo-terminal (pty), if the system C
library contains the <B>forkpty</B>(3) routine.  Use of ptys are necessary
when the program to be invoked cannot be run without a "terminal" for
I/O.  See below on how to properly associate the I/O variable.
<p>
<dt>
magic paths <B>/dev/stdin</B>, <B>/dev/stdout</B>, and <B>/dev/stderr</B>
<dd>
<B>/dev/stdin</B>, <B>/dev/stdout</B>, and <B>/dev/stderr</B> refer to the current
process standard input, standard output and standard error I/O streams
respectively <I>regardless</I> of whether those special filenames exist on
your system.
<p>
<dt>
magic path <B>/dev/fd/</B><I>n</I>
<dd>
<B>/dev/fd/</B><I>n</I> uses <B>fdopen</B>(3) to open a new I/O stream associated
with file descriptor number <I>n</I>, regardless of whether the special
device entries exist.
<p>
<dt>
magic paths <B>/tcp/</B><I>hostname</I>/<I>service</I> and  <B>/udp/</B><I>hostname</I>/<I>service</I>
<dd>
<B>/tcp/</B><I>hostname</I>/<I>service</I> can be used to open connection to a TCP
server. If the path ends in the optional suffix <B>/priv</B> the local
address will be bound to a port number below 1024, if process
privileges allow.  <B>/udp/</B><I>hostname</I>/<I>service</I> behaves similarly
for UDP.
<p>
<dt>
magic pathname <B>/dev/tmpfile</B>
<dd>
<B>/dev/tmpfile</B> opens an anonymous temporary file for reading and writing, see
<B>tmpfile</B>(3).
<p>
<dt>
<B>/dev/null</B> and <B>/dev/tty</B>
<dd>
On non-POSIX systems <B>/dev/null</B> and <B>/dev/tty</B> are magical, and
refer to the null device, and the user's terminal/console,
respectively.
</dl>
<h3>I/O Options</h3>
Originally the third argument specified record length for <B>INPUT()</B>,
or a <B>FORTRAN</B> <B>FORMAT</B> for <B>OUTPUT()</B>.
<p>
CSNOBOL4 interprets it as string of single letter options, commas are ignored.
Some options effect only the I/O variable named in the first argument,
others effect any variable associated with the unit number in the
second argument.
<dl>
<p>
<dt>
<I>digits</I>
<dd>
A span of digits will set the input record length for the named I/O
variable.  This controls the maximum string that will be returned for
regular text I/O, and the number of bytes returned for binary I/O.
Record length is per-variable association; multiple variables may be
associated with the same unit, but with different record lengths.  The
default record length for input is 1024. Lines longer than the record
length will be silently truncated.
<p>
<dt>
<B>A</B>
<dd>
For <B>OUTPUT()</B> the unit will be opened for append access (and ignored by
<B>INPUT()</B>).  All writes will occur at the end of the file at the time
of the write, regardless of the file position before the write.
<p>
<dt>
<B>B</B>
<dd>
The unit will be opened for binary access.  On input, newline
characters have no special meaning; the number of bytes transferred
depends on record length (see above). On output, no newline is
appended.
<p>
<dt>

<dd>
For terminal devices, all input from this unit will be done without
special processing for line editing or EOF; the number of characters
returned depends on the record length.
Characters which deliver signals (including interrupt, kill, and suspend)
are still processed.  Units (with different fds) opened on the same terminal
device operate independently; some can use binary mode, while others
operate in text mode.
<p>
<dt>
<B>C</B>
<dd>
Character at a time I/O.  A synonym for <B>B,1</B>.
<p>
<dt>
<B>T</B>
<dd>
Terminal mode.  Writes are performed &ldquo;unbuffered&rdquo; (see below), and
no newline characters are added. On input newline characters are
returned.  Terminal mode effects only the referenced unit, and does
not require opening a new file descriptor (ie; by using a magic
pathname): <B>OUTPUT(.TT, 8, "T", "-")</B>.  Terminal mode is useful for
outputting prompts in interactive programs.
<p>
<dt>
<B>Q</B>
<dd>
Quiet mode.  Turns off input echo on terminals.
Effects only input on this file descriptor.
<p>
<dt>
<B>U</B>
<dd>
Update mode.  The unit is opened for both input and output.
Example of associating a variable for I/O in both directions:
<pre>
        unit = IO_FINDUNIT()
        INPUT(.name, unit, 'U', 'filepath')
        OUTPUT(.name, unit)
</pre>
<p>
<dt>

<dd>
Useful situations for this when filepath is <B>/dev/fd/</B><I>n</I> where <I>n</I>
is a file descriptor number returned by <B>SERV_LISTEN(),</B> or
<TT>filepath</TT> specifies a pipe (<B>|command</B>) or pseudo-terminal
(<B>||command</B>) paths.
<p>
<dt>

<dd>
The above sequence is also useful with when combined with fixed record
length, binary mode and the <B>SET()</B> function for I/O to preexisting
files.  Performing <B>OUTPUT()</B> first will create a regular file if it
does not exist, but will also truncate a preexisting file!
<p>
<dt>
<B>W</B>
<dd>
Unbuffered mode.  Each output variable assignment causes an immediate I/O
transfer to occur by direct <B>read</B>(1) or <B>write</B>(1) system calls,
rather than collecting the data in a buffer for efficiency.
</dl>
<h3>Other I/O extensions</h3>
<dl>
<p>
<dt>
<B>SERV_LISTEN()</B>, <B>SET()</B>, <B>SSET()</B>
<dd>
see <a href="snobol4func.1.html"><B>snobol4func</B>(1)</a>.
</dl>
<h3>I/O Layers</h3>
The Macro SNOBOL4 and POSIX I/O architectures
have subtleties which interact, and are explained here:
<dl>
<p>
<dt>
Variable association
<dd>
Input and output is done by reading or writing variables associated
with a unit number for I/O.
<p>
<dt>

<dd>
Input (maximum) record lengths are associated each <I>variable association</I>!
<p>
<dt>
Unit number
<dd>
Multiple variables can be associated with the same unit number
using the <B>INPUT()</B> and <B>OUTPUT()</B> functions.
<p>
<dt>

<dd>
Each unit number refers to a <B>stdio</B>(3) stream
(except on broken systems like Windows, where socket handles
are incompatible with file handles, and all network I/O
is performed &ldquo;unbuffered&rdquo;).
<p>
<dt>

<dd>
Sequential named files can be associated with an I/O unit
when the <B>-r</B> option is given on the command line!
<B>REWIND()</B> should return to to after the program <B>END</B> label!
<p>
<dt>
&ldquo;Standard I/O&rdquo; Stream
<dd>
<a href="snobol4.1.html"><B>snobol4</B>(1)</a> performs <B>MOST</B> I/O through &ldquo;Standard Input/Output&rdquo;
streams. Multiple units can be associated with the same stdio stream
(<B>FILE</B> struct) using magic pathnames
(&ldquo;<B>-</B>&rdquo; and <B>/dev/std</B>{<B>in,out,err</B>}).
Buffering is performed by the stdio layer.
<p>
<dt>
Operating System file descriptor
<dd>
More than one stdio stream can be associated with the same O/S &ldquo;fd&rdquo;
(by opening magic pathname &ldquo;<B>/dev/fd/</B><I>n</I>&rdquo;).
<p>
<dt>

<dd>
Each POSIX &ldquo;fd&rdquo; has a file position pointer, changed by
reading, writing and the <B>REWIND()</B>, <B>SET()</B> and <B>SSET()</B> functions.
<p>
<dt>

<dd>
<I>Normally</I> terminal device &ldquo;special files&rdquo; have one set of
mode settings, but CSNOBOL4 associates (saves and restores) different
terminal settings (echo and the number of characters returned on read)
based on fd numbers.
<p>
<dt>
Operating System open file object
<dd>
More than one &ldquo;fd&rdquo; slot can be associated with the same &ldquo;open file&rdquo;
object, either in multiple forks, or by <B>dup</B>(2) of the same fd.
This is often the case for stdin, stdout and stderr.
<p>
<dt>

<dd>
Open file objects have flags which effect all associated fds,
including input, output and append modes.
<p>
<dt>
Operating System named file
<dd>
Independent opens of the same named &ldquo;regular&rdquo; file will have
different open file objects, and thus have independent access modes
and file positions.
<p>
<dt>

<dd>
Terminal devices normally have one set of &ldquo;line discipline&rdquo;
mode settings, but CSNOBOL4 maintains different settings for each
file descriptor (see above).
</dl>
<h2>BUGS</h2>
This page was cut and pasted from various parts of the original
<a href="snobol4.1.html"><B>snobol4</B>(1)</a> man page, and still needs review and cleanup.
<p>
All extensions should be annotated with the version they appeared in
(and what other implementations they're compatible or inspired by).
<p>
Record lengths.
<p>
Unit numbers.
<h2>SEE ALSO</h2>
<a href="snobol4.1.html"><B>snobol4</B>(1)</a>
</body>
</html>
